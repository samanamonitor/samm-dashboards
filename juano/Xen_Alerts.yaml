apiVersion: 1
groups:
    - orgId: 1
      name: Xen_Alerts
      folder: Juano
      interval: 1m
      rules:
        - uid: celz65vg3hmo0c
          title: XS-Host-AvgCPU
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: c3a5e98c-6e94-44b8-b894-ae05241051b7
              model:
                datasource:
                    type: prometheus
                    uid: c3a5e98c-6e94-44b8-b894-ae05241051b7
                disableTextWrap: false
                editorMode: builder
                expr: xen_host_cpu_avg
                fullMetaSearch: false
                includeNullMetadata: true
                instant: true
                intervalMs: 1000
                legendFormat: '{{uuid}}'
                maxDataPoints: 43200
                range: false
                refId: A
                useBackend: false
            - refId: B
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0.8
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          noDataState: NoData
          execErrState: Error
          for: 0s
          annotations:
            description: This is a test alert.
            runbook_url: /d/eejm2zr88efwgc/xs-pool-info-v1-1?orgId=1
            summary: SAMM Test Alert - Ignore it.
          isPaused: false
          notification_settings:
            receiver: critical-mmm
        - uid: eelz7roxohekgf
          title: XS-Host-SR-Latency
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: c3a5e98c-6e94-44b8-b894-ae05241051b7
              model:
                datasource:
                    type: prometheus
                    uid: c3a5e98c-6e94-44b8-b894-ae05241051b7
                disableTextWrap: false
                editorMode: builder
                expr: xen_host_sr_latency
                fullMetaSearch: false
                includeNullMetadata: true
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
                useBackend: false
            - refId: B
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 1500
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: ceje21dg8hlogcR
          panelId: 18
          noDataState: NoData
          execErrState: Error
          for: 0s
          annotations:
            __dashboardUid__: ceje21dg8hlogcR
            __panelId__: "18"
            runbook_url: /d/ceje21dg8hlogc/xs-host-info?orgId=1&var-xen_host_uuid={{uuid}}
          labels: {}
          isPaused: false
          notification_settings:
            receiver: samanascp
        - uid: felzbu6sfc4cgf
          title: Read / Write Disk Latency
          condition: D
          data:
            - refId: A
              relativeTimeRange:
                from: 10800
                to: 0
              datasourceUid: c3a5e98c-6e94-44b8-b894-ae05241051b7
              model:
                datasource:
                    type: prometheus
                    uid: c3a5e98c-6e94-44b8-b894-ae05241051b7
                disableTextWrap: false
                editorMode: code
                expr: -xen_vm_vbd_write_latency{uuid="8bf4282c-d658-0c94-4692-135a4936cb0c"}
                fullMetaSearch: false
                includeNullMetadata: true
                instant: false
                interval: ""
                intervalMs: 15000
                legendFormat: 'WR Disk: {{device}}'
                maxDataPoints: 43200
                range: true
                refId: A
                useBackend: false
            - refId: B
              relativeTimeRange:
                from: 10800
                to: 0
              datasourceUid: c3a5e98c-6e94-44b8-b894-ae05241051b7
              model:
                datasource:
                    type: prometheus
                    uid: c3a5e98c-6e94-44b8-b894-ae05241051b7
                disableTextWrap: false
                editorMode: code
                expr: xen_vm_vbd_read_latency{uuid="8bf4282c-d658-0c94-4692-135a4936cb0c"}
                fullMetaSearch: false
                includeNullMetadata: true
                instant: false
                interval: ""
                intervalMs: 15000
                legendFormat: 'RD Disk: {{device}}'
                maxDataPoints: 43200
                range: true
                refId: B
                useBackend: false
            - refId: C
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: C
                type: reduce
            - refId: D
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - D
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: C
                intervalMs: 1000
                maxDataPoints: 43200
                refId: D
                type: threshold
          dashboardUid: vm-info-modern-v3jp
          panelId: 19
          noDataState: NoData
          execErrState: Error
          for: 1m
          annotations:
            __dashboardUid__: vm-info-modern-v3jp
            __panelId__: "19"
          labels: {}
          isPaused: false
          notification_settings:
            receiver: samanascp
        - uid: eemh532gqzocgb
          title: SR Read / Write Latency
          condition: D
          data:
            - refId: A
              relativeTimeRange:
                from: 3600
                to: 0
              datasourceUid: c3a5e98c-6e94-44b8-b894-ae05241051b7
              model:
                datasource:
                    type: prometheus
                    uid: c3a5e98c-6e94-44b8-b894-ae05241051b7
                disableTextWrap: false
                editorMode: code
                expr: "xen_host_sr_read_latency{uuid=\"382e98ba-9176-48a9-8ae1-254fb6aa1d9e\"} \r\n    * on (  sr_uuid) group_left (sr_name)\r\n    (\r\n        label_replace ( xen_sr_info, \"sr_name\", \"$1\", \"name_label\", \"(.*)\" )\r\n   )"
                fullMetaSearch: false
                includeNullMetadata: true
                instant: false
                interval: ""
                intervalMs: 15000
                legendFormat: '{{sr_name}}'
                maxDataPoints: 43200
                range: true
                refId: A
                useBackend: false
            - refId: B
              relativeTimeRange:
                from: 3600
                to: 0
              datasourceUid: c3a5e98c-6e94-44b8-b894-ae05241051b7
              model:
                datasource:
                    type: prometheus
                    uid: c3a5e98c-6e94-44b8-b894-ae05241051b7
                disableTextWrap: false
                editorMode: code
                expr: "-xen_host_sr_read_latency{uuid=\"382e98ba-9176-48a9-8ae1-254fb6aa1d9e\"} \r\n    * on (  sr_uuid) group_left (sr_name)\r\n    (\r\n        label_replace ( xen_sr_info, \"sr_name\", \"$1\", \"name_label\", \"(.*)\" )\r\n   )"
                fullMetaSearch: false
                includeNullMetadata: true
                instant: false
                interval: ""
                intervalMs: 15000
                legendFormat: '{{sr_name}}'
                maxDataPoints: 43200
                range: true
                refId: B
                useBackend: false
            - refId: C
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: C
                type: reduce
            - refId: D
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 5000
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - D
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: C
                intervalMs: 1000
                maxDataPoints: 43200
                refId: D
                type: threshold
          dashboardUid: ceje21dg8hlogcR
          panelId: 18
          noDataState: NoData
          execErrState: Error
          for: 1m
          annotations:
            __dashboardUid__: ceje21dg8hlogcR
            __panelId__: "18"
          labels: {}
          isPaused: false
          notification_settings:
            receiver: samanascp
        - uid: cemnxpgmar11cf
          title: CPU Info
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 3600
                to: 0
              datasourceUid: c3a5e98c-6e94-44b8-b894-ae05241051b7
              model:
                datasource:
                    type: prometheus
                    uid: c3a5e98c-6e94-44b8-b894-ae05241051b7
                disableTextWrap: false
                editorMode: builder
                expr: xen_host_cpu_avg
                fullMetaSearch: false
                includeNullMetadata: true
                instant: false
                interval: ""
                intervalMs: 15000
                legendFormat: '{{name_label}}'
                maxDataPoints: 43200
                range: true
                refId: A
                useBackend: false
            - refId: B
              relativeTimeRange:
                from: 3600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 3600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0.9
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: ceje21dg8hlogcR
          panelId: 5
          noDataState: NoData
          execErrState: Error
          for: 1m
          annotations:
            __dashboardUid__: ceje21dg8hlogcR
            __panelId__: "5"
          labels:
            severity: critical
          isPaused: false
          notification_settings:
            receiver: samanascp
